<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SURYA JYOTI SECONDARY SCHOOL - CLASS 11 GRADE SHEET (DEMO)</title>
    <!-- Include html2canvas library from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        /* === General Styling === */
        body {
            font-family: Calibri, 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0; padding: 0; background-color: #f0f2f5;
            color: #333; line-height: 1.5; font-size: 10.5pt;
        }

        /* === Search Form Styling === */
        .search-form-container {
            width: 800px; margin: 20px auto; padding: 20px; background-color: #fff;
            border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center;
        }
        .search-form-container h2 { margin-top: 0; color: #004a99; font-size: 14pt; text-transform: uppercase;}
        .search-form-container label { font-weight: 600; margin-right: 10px; text-transform: uppercase;}
        .search-form-container input[type="text"] {
            padding: 8px 12px; font-size: 11pt; border: 1px solid #ccc;
            border-radius: 4px; width: 200px; margin-right: 10px;
        }
        .search-form-container button[type="submit"] {
            padding: 8px 20px; font-size: 11pt; font-weight: 600; background-color: #007bff;
            color: white; border: none; border-radius: 4px; cursor: pointer;
            transition: background-color 0.2s ease; text-transform: uppercase;
        }
        .search-form-container button[type="submit"]:hover { background-color: #0056b3; }
        .error-message { color: #D8000C; background-color: #FFD2D2; border: 1px solid #D8000C; padding: 10px; margin-top: 15px; border-radius: 4px; text-align: center; }

        /* === Grade Sheet Container (Screen style with Box) === */
        .gradesheet-container {
            width: 210mm; min-height: 270mm; margin: 25px auto; padding: 15mm;
            background-color: #ffffff; border: 1px solid #cccccc;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1); box-sizing: border-box;
            position: relative; display: none; /* Initially hidden */
        }

        /* === Header Section === */
        .header {
            display: flex; align-items: center;
            padding-bottom: 15px; margin-bottom: 20px;
            border-bottom: 3px solid #0056b3;
        }
        .header .logo { width: 70px; height: 70px; flex-shrink: 0; margin-right: 15px; }
        .header .logo img { max-width: 100%; max-height: 100%; display: block; }
        .header .title { text-align: center; flex-grow: 1; color: #003366; }
        .header .title h1, .header .title h2, .header .title h3, .header .title h4, .header .title h5 {
             margin: 1px 0; font-weight: bold; color: #0056b3; text-transform: uppercase;
        }
        .header .title h1 {
            font-size: 18pt; /* --- Increased Font Size --- */
            font-weight: bold; /* Ensure it's bold */
            letter-spacing: 1px;
        }
        .header .title h2 { font-size: 11pt; }
        .header .title h3 { font-size: 10pt; font-weight: normal; }
        .header .title h4 { font-size: 12pt; margin-top: 5px; }
        .header .title h5 { font-size: 14pt; letter-spacing: 1px;}

        /* === Student Information Section (Screen Styles - Boxed) === */
        .student-info {
            margin-bottom: 20px; padding: 12px 15px;
            background-color: #f8fbff; border: 1px solid #d6e7f9;
            border-radius: 5px; font-size: 10.5pt;
        }
        .student-info table { width: 100%; border-collapse: collapse; }
        .student-info td { padding: 3px 5px; vertical-align: top; }
        .student-info td.label { font-weight: 600; color: #004085; width: 130px; white-space: nowrap; }
        .student-info td.value { font-weight: normal; }
        .dotted-line { display: none; }

        /* === Separator Line (Hide on screen) === */
        hr.separator { display: none; }

        /* === Grades Table Styling (Revised Screen Styles) === */
        .grades-table {
            width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 9pt;
            border: 1.5pt solid #004a99;
        }
        .grades-table th, .grades-table td { padding: 5px 7px; text-align: left; vertical-align: middle; border-top: 0.5pt solid #d0d9e3; border-bottom: 0.5pt solid #d0d9e3; border-left: 1pt solid #a8b8c8; border-right: 1pt solid #a8b8c8; }
        .grades-table th:first-child, .grades-table td:first-child { border-left: none; }
        .grades-table th:last-child, .grades-table td:last-child { border-right: none; }
        .grades-table thead th { background: linear-gradient(to bottom, #f0f6fc, #d9e6f5); color: #003366; font-weight: 600; text-align: center; font-size: 9.5pt; padding: 7px 7px; text-transform: uppercase; border-bottom: 1pt solid #a8b8c8; border-top: none; }
        .grades-table td:nth-child(1),.grades-table td:nth-child(3),.grades-table td:nth-child(4),.grades-table td:nth-child(5),.grades-table td:nth-child(6) { text-align: center; }
        .grades-table tbody tr:nth-child(even) { background-color: #fafdff; }
        .grades-table td.final-grade { font-weight: bold; vertical-align: middle; text-align: center; }
        .grades-table tfoot td { font-weight: bold; background-color: #eef4fa; text-align: right; padding: 6px 12px; font-size: 10pt; color: #003366; border-top: 1pt solid #a8b8c8; border-bottom: none; }
        .grades-table tfoot td:nth-child(2) { font-weight: bold; text-align: center;}

        /* === Notes Section (Screen Styles - Boxed) === */
        .notes {
            font-size: 9pt; color: #444; line-height: 1.4; padding: 12px 15px;
            background-color: #f9f9f9; border: 1px solid #e5e5e5; border-radius: 5px;
        }
        .notes strong { color: #000; }
        .notes h4 { margin: 0 0 6px 0; font-size: 10pt; font-weight: 600; color: #333; text-transform: uppercase; }
        .notes ul { list-style: none; padding-left: 0; margin: 0; }
        .notes ul li { display: inline-block; margin-right: 12px; white-space: nowrap; }

        /* === Action Buttons Container === */
        .action-buttons { text-align: center; margin: 30px 0 10px; display: none; }
        .action-buttons button { padding: 10px 25px; font-size: 12pt; font-weight: 600; color: white; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.2s ease, box-shadow 0.2s ease; box-shadow: 0 2px 5px rgba(0,0,0,0.15); text-transform: uppercase; margin: 0 10px; }
        #printButton { background-color: #28a745; }
        #printButton:hover { background-color: #218838; }
        #savePngButton { background-color: #ffc107; color: #333; }
        #savePngButton:hover { background-color: #e0a800; }

        /* === Class to Hide Element for PNG === */
        .hide-for-png {
            display: none !important; /* Hide element when this class is applied */
            visibility: hidden !important; /* Extra measure */
        }

        /* === Print Specific Styles (Boxed Sections) === */
        @page { size: A4; margin: 12mm; }
        @media print {
            body { font-family: Arial, sans-serif; font-size: 9pt; background-color: #fff; margin: 0; padding: 0; color: #000 !important; }
            .gradesheet-container { width: 100%; min-height: initial; margin: 0; padding: 0; border: none !important; box-shadow: none !important; display: block !important; }
            .noprint, .search-form-container, .action-buttons, .disclaimer, .hide-for-png { display: none !important; } /* Hide logo for print too */
            hr.separator { display: none !important; }
            .header, .student-info, .grades, .notes { page-break-inside: avoid; margin-bottom: 6mm !important; padding: 4mm !important; border: 0.75pt solid #e0e0e0 !important; background-color: #fdfdfd !important; border-radius: 3px; }
            .header { border: none !important; background-color: transparent !important; padding: 0 0 4mm 0 !important; margin-bottom: 4mm !important; border-bottom: 1pt solid #999 !important; border-radius: 0; }
             .grades { padding: 0 !important; border: none !important; background-color: transparent !important; margin-bottom: 6mm !important; }
              .notes { border: 0.75pt solid #e0e0e0 !important; background-color: #fdfdfd !important; padding: 4mm !important; margin-top: 5mm !important; margin-bottom: 0 !important; }
            .header .title h1 { font-size: 14pt !important; white-space: nowrap; }
            .header .title h2 { font-size: 10pt !important; }
            .header .title h3 { font-size: 9pt !important; }
            .header .title h4 { font-size: 11pt !important; }
            .header .title h5 { font-size: 13pt !important; }
            .student-info { font-size: 9pt !important; }
            .student-info table { width: 100%; }
            .student-info td { padding: 1px 3px !important; vertical-align: top !important; }
            .student-info td.label { color: #000 !important; font-weight: bold !important; width: auto !important; white-space: nowrap; padding-right: 5px !important; }
            .student-info td.value { font-weight: bold !important; border-bottom: none !important; }
            .dotted-line { display: none !important; }
             .grades-table { border: 1pt solid #bbb !important; font-size: 8.5pt !important; margin-bottom: 0 !important; }
             .grades-table th, .grades-table td { border: 0.5pt solid #ccc !important; padding: 2.5px 4px !important; }
             .grades-table thead th { background-color: #ededed !important; color: #000 !important; font-size: 8.5pt !important; font-weight: bold !important; border-bottom: 1pt solid #aaa !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
             .grades-table tfoot td { background-color: #f0f0f0 !important; font-size: 9.5pt !important; color: #000 !important; border-top: 1pt solid #aaa !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
             .grades-table tfoot td:nth-child(2) { font-weight: bold !important;}
             .grades-table tbody tr:nth-child(even) { background-color: transparent !important; }
             .notes h4 { font-size: 9pt !important; }
             .notes ul li { margin-right: 10px !important;}
             * { background-color: transparent !important; box-shadow: none !important; text-shadow: none !important; color: #000 !important; }
            a { text-decoration: none; }
            img { max-width: 100% !important; }
        }

         /* Style for PNG generation to mimic print */
        .generating-png { border: none !important; box-shadow: none !important; padding: 12mm !important; background-color: #ffffff !important; }
        .generating-png .header, .generating-png .student-info, .generating-png .grades, .generating-png .notes { margin-bottom: 6mm !important; padding: 4mm !important; border: 0.75pt solid #e0e0e0 !important; background-color: #fdfdfd !important; border-radius: 3px; }
        .generating-png .header { border: none !important; background-color: transparent !important; padding: 0 0 4mm 0 !important; margin-bottom: 4mm !important; border-bottom: 1pt solid #999 !important; border-radius: 0; }
        /* Ensure logo is hidden when generating PNG */
        .generating-png .hide-for-png { display: none !important; visibility: hidden !important; }
        .generating-png .grades { padding: 0 !important; border: none !important; background-color: transparent !important; margin-bottom: 6mm !important; }
        .generating-png .notes { border: 0.75pt solid #e0e0e0 !important; background-color: #fdfdfd !important; padding: 4mm !important; margin-top: 5mm !important; margin-bottom: 0 !important; }
        .generating-png .student-info { border: 0.75pt solid #e0e0e0 !important; background-color: #fdfdfd !important; }
        .generating-png .grades-table { border: 1pt solid #bbb !important; }
        .generating-png .grades-table th, .generating-png .grades-table td { border: 0.5pt solid #ccc !important; }
        .generating-png .grades-table thead th { background-color: #ededed !important; color: #000 !important; border-bottom: 1pt solid #aaa !important; }
        .generating-png .grades-table tfoot td { background-color: #f0f0f0 !important; color: #000 !important; border-top: 1pt solid #aaa !important; }
        .generating-png .student-info td.label { color: #000 !important; }
        .generating-png * { font-family: Arial, sans-serif !important; color: #000 !important; background-color: transparent !important; }

    </style>
</head>
<body>

    <!-- Search Form Section -->
    <div class="search-form-container noprint">
        <h2>VIEW GRADE SHEET</h2>
        <form id="searchForm">
            <label for="symbol">SYMBOL NUMBER:</label>
            <input type="text" id="symbol" name="symbol" placeholder="Enter Symbol No." required>
            <button type="submit">SEARCH</button>
        </form>
        <div id="errorMessage" class="error-message" style="display: none;"></div>
    </div>

    <!-- Grade Sheet Section (Initially Hidden) -->
    <div class="gradesheet-container" id="gradesheetResult">
        <!-- Content dynamically loaded here by JavaScript -->
    </div>

    <!-- Action Buttons Container (Initially Hidden) -->
    <div class="action-buttons noprint" id="actionButtonsDiv">
        <button id="printButton" onclick="window.print()">PRINT GRADE SHEET</button>
        <button id="savePngButton">SAVE AS PNG</button>
    </div>

    <script>
        // --- 1. Embedded Student Data ---
        const allStudentsData = { '15901674': { name: 'ALINA GIRI', roll: '1', reg_no: '816590070001', dob: '2060-10-16', dob_ad: '2004-01-30', sex: 'Female', grade_level: 'XI', exam_year_bs: 2081, exam_year_ad: 2024, gpa: 2.39, subjects: {'0011': ['B', 2.8, 'A', 3.6, 'B'],'0031': ['D', 1.6, 'A', 3.6, 'C'],'0051': ['C', 2.0, 'A', 3.6, 'C+'],'1031': ['C', 2.0, 'A', 3.6, 'C+'],'2151': ['C', 2.0, 'B+', 3.2, 'C'],'3031': ['C', 2.0, 'B+', 3.2, 'C']} }, '15901675': { name: 'ANJALI BUDHA', roll: '2', reg_no: '816590070002', dob: '2062-03-10', dob_ad: '', sex: 'Female', grade_level: 'XI', exam_year_bs: 2081, exam_year_ad: 2024, gpa: 2.05, subjects: {'0011': ['C', 2.0, 'B+', 3.2, 'C'],'0031': ['D', 1.6, 'B+', 3.2, 'C'],'0051': ['D', 1.6, 'B', 2.8, 'D'],'1151': ['D', 1.6, 'B+', 3.2, 'C'],'2231': ['D', 1.6, 'A', 3.6, 'C'],'3311': ['D', 1.6, 'A', 3.6, 'C']} }, '15901676': { name: 'ARJUN SIRPALI', roll: '3', reg_no: '816590070003', dob: '2063-03-04', dob_ad: '', sex: 'Male', grade_level: 'XI', exam_year_bs: 2081, exam_year_ad: 2024, gpa: 2.02, subjects: {'0011': ['C+', 2.4, 'B+', 3.2, 'C+'],'0031': ['D', 1.6, 'C', 2.0, 'D'],'0051': ['D', 1.6, 'C', 2.0, 'D'],'1151': ['D', 1.6, 'B', 2.8, 'D'],'2231': ['C', 2.0, 'B+', 3.2, 'C'],'3311': ['D', 1.6, 'A', 3.6, 'C']} }, '15901677': { name: 'ARJUN SUNAR', roll: '4', reg_no: '816590070004', dob: '2064-10-16', dob_ad: '', sex: 'Male', grade_level: 'XI', exam_year_bs: 2081, exam_year_ad: 2024, gpa: 2.02, subjects: {'0011': ['D', 1.6, 'B+', 3.2, 'C'],'0031': ['D', 1.6, 'B+', 3.2, 'C'],'0051': ['D', 1.6, 'B', 2.8, 'D'],'1031': ['D', 1.6, 'A', 3.6, 'C'],'2151': ['D', 1.6, 'A', 3.6, 'C'],'3031': ['D', 1.6, 'B+', 3.2, 'C']} }, '15901678': { name: 'ARJUN TAMATA', roll: '5', reg_no: '816590070005', dob: '2063-12-09', dob_ad: '', sex: 'Male', grade_level: 'XI', exam_year_bs: 2081, exam_year_ad: 2024, gpa: 2.04, subjects: {'0011': ['C+', 2.4, 'A', 3.6, 'C+'],'0031': ['D', 1.6, 'B+', 3.2, 'C'],'0051': ['D', 1.6, 'C+', 2.4, 'D'],'1151': ['D', 1.6, 'B', 2.8, 'D'],'2231': ['D', 1.6, 'B+', 3.2, 'C'],'3311': ['D', 1.6, 'A', 3.6, 'C']} }, '15901679': { name: 'ARJUN KUMAR NEPALI', roll: '6', reg_no: '816590070006', dob: '2063-12-15', dob_ad: '', sex: 'Male', grade_level: 'XI', exam_year_bs: 2081, exam_year_ad: 2024, gpa: 3.61, subjects: {'0011': ['A', 3.6, 'A+', 4.0, 'A'],'0031': ['B', 2.8, 'A+', 4.0, 'B'],'0051': ['B+', 3.2, 'A+', 4.0, 'B+'],'1031': ['A+', 4.0, 'A+', 4.0, 'A+'],'2151': ['A', 3.6, 'A+', 4.0, 'A'],'3031': ['A', 3.6, 'A+', 4.0, 'A']} } };
        const subjectDetails = { '0011': { name: 'Com. Nepali', th_crhr: 2.25, in_crhr: 0.75 }, '0031': { name: 'Com. English', th_crhr: 3.00, in_crhr: 1.00 }, '0051': { name: 'Com. Social Studies & Life Skill Edu.', th_crhr: 3.75, in_crhr: 1.25 }, '1031': { name: 'Accounting', th_crhr: 3.75, in_crhr: 1.25 }, '1151': { name: 'Child Development and Learning', th_crhr: 3.75, in_crhr: 1.25 }, '2151': { name: 'Business Studies', th_crhr: 3.75, in_crhr: 1.25 }, '2231': { name: 'Population Studies', th_crhr: 3.75, in_crhr: 1.25 }, '3031': { name: 'Economics', th_crhr: 3.75, in_crhr: 1.25 }, '3311': { name: 'Nepali', th_crhr: 3.75, in_crhr: 1.25 }};

        // --- 3. Function to Generate Grade Sheet HTML ---
        function generateGradeSheetHTML(symbol, student) {
            const studentInfoHTML = `<table><tr><td class="label">Student's Name:</td><td class="value">${student.name}<span class="dotted-line"></span></td><td class="label">Symbol No:</td><td class="value">${symbol}<span class="dotted-line"></span></td></tr><tr><td class="label">Registration No:</td><td class="value">${student.reg_no}<span class="dotted-line"></span></td><td class="label">Date of Birth:</td><td class="value">${student.dob}<span class="dotted-line"></span></td></tr><tr><td class="label">Grade:</td><td class="value">${student.grade_level}<span class="dotted-line"></span></td><td class="label">Gender:</td><td class="value">${student.sex}<span class="dotted-line"></span></td></tr><tr><td class="label">Exam Year:</td><td class="value" colspan="3">${student.exam_year_bs} B.S.<span class="dotted-line"></span></td></tr></table>`;
            let tableRowsHTML = ''; const sortedSubjectCodes = Object.keys(student.subjects).sort();
            for (const th_code of sortedSubjectCodes) { if (subjectDetails[th_code] && student.subjects[th_code]) { const details = subjectDetails[th_code]; const grades = student.subjects[th_code]; const in_code = String(parseInt(th_code) + 1).padStart(4, '0'); const th_grade = grades[0] || ''; const th_gp = grades[1] !== undefined ? grades[1].toFixed(1) : ''; const in_grade = grades[2] || ''; const in_gp = grades[3] !== undefined ? grades[3].toFixed(1) : ''; const final_grade = grades[4] || ''; tableRowsHTML += `<tr><td>${th_code}</td><td>${details.name} (TH)</td><td>${details.th_crhr.toFixed(2)}</td><td>${th_gp}</td><td>${th_grade}</td><td rowspan="2" class="final-grade">${final_grade}</td><td rowspan="2"></td></tr><tr><td>${in_code}</td><td>${details.name} (IN)</td><td>${details.in_crhr.toFixed(2)}</td><td>${in_gp}</td><td>${in_grade}</td></tr>`; } }
            // *** IMPORTANT: Added id="schoolLogo" to the div containing the logo ***
            const gradeSheetHTML = `<header class="header"><div class="logo" id="schoolLogo"><img src="school_logo.png" alt="School Logo"></div><div class="title"><h1>SURYA JYOTI SECONDARY SCHOOL MEHELKUNA</h1><h2>GURBHAKOT MUNICIPALITY-08, SURKHET</h2><h3>KARNALI PROVINCE, NEPAL</h3><h4>FINAL EXAMINATION - ${student.exam_year_bs || '2081'}</h4><h5>GRADE SHEET</h5></div></header><section class="student-info">${studentInfoHTML}</section><section class="grades"><table class="grades-table"><thead><tr><th rowspan="2">SUBJECT CODE</th><th rowspan="2">SUBJECTS</th><th rowspan="2">CREDIT HOUR</th><th rowspan="2">GRADE POINT</th><th rowspan="2">GRADE</th><th rowspan="2">FINAL GRADE</th><th rowspan="2">REMARKS</th></tr></thead><tbody>${tableRowsHTML}</tbody><tfoot><tr><td colspan="5">GRADE POINT AVERAGE (GPA) :</td><td style="text-align:center;">${student.gpa.toFixed(2)}</td><td></td></tr></tfoot></table></section><section class="notes"><h4>NOTES:</h4><ul><li>TH: Theory</li><li>PR: Practical</li><li>IN: Internal Assessment</li><li>Abs: Absent</li><li>W: Withheld</li><li>NG: Non-Graded</li><li>One Credit Hour = 32 Clock Hours</li></ul></section>`;
            return gradeSheetHTML;
        }

        // --- 4. Handle Search Form Submission ---
        document.getElementById('searchForm').addEventListener('submit', function(event) { event.preventDefault(); const searchSymbol = document.getElementById('symbol').value.trim(); const resultContainer = document.getElementById('gradesheetResult'); const errorContainer = document.getElementById('errorMessage'); const actionButtonsDiv = document.getElementById('actionButtonsDiv'); errorContainer.style.display = 'none'; resultContainer.style.display = 'none'; actionButtonsDiv.style.display = 'none'; if (searchSymbol === '') { errorContainer.textContent = 'Please enter a Symbol Number.'; errorContainer.style.display = 'block'; return; } if (allStudentsData[searchSymbol]) { const student = allStudentsData[searchSymbol]; const htmlContent = generateGradeSheetHTML(searchSymbol, student); resultContainer.innerHTML = htmlContent; resultContainer.style.display = 'block'; actionButtonsDiv.style.display = 'block'; } else { errorContainer.textContent = `Symbol Number '${searchSymbol}' not found.`; errorContainer.style.display = 'block'; } });

        // --- 5. Handle Save as PNG Button Click (Using CSS Class Toggle) ---
        document.getElementById('savePngButton').addEventListener('click', function() {
            const gradesheetElement = document.getElementById('gradesheetResult');
            const logoElement = gradesheetElement.querySelector('#schoolLogo'); // Get the logo element by ID
            const symbol = document.getElementById('symbol').value.trim() || 'gradesheet';
            const studentData = allStudentsData[symbol];
            const studentName = studentData ? studentData.name.replace(/\s+/g, '_') : 'student';
            const filename = `GradeSheet_${studentName}_${symbol}.png`;

            if (gradesheetElement && html2canvas && logoElement) {
                 const originalContainerBorder = gradesheetElement.style.border;
                 const originalContainerShadow = gradesheetElement.style.boxShadow;

                 // --- Hide logo and remove container border/shadow ---
                 logoElement.classList.add('hide-for-png');
                 gradesheetElement.style.border = 'none';
                 gradesheetElement.style.boxShadow = 'none';
                 gradesheetElement.classList.add('generating-png'); // Apply print-like styles
                 // ---

                html2canvas(gradesheetElement, {
                    scale: 1.5,
                    useCORS: true,
                    logging: true,
                    backgroundColor: '#ffffff'
                })
                 .then(canvas => {
                    // --- Restore everything ---
                    logoElement.classList.remove('hide-for-png');
                    gradesheetElement.classList.remove('generating-png');
                    gradesheetElement.style.border = originalContainerBorder;
                    gradesheetElement.style.boxShadow = originalContainerShadow;
                    // ---

                    const image = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
                    const link = document.createElement('a');
                    link.download = filename; link.href = image;
                    document.body.appendChild(link); link.click(); document.body.removeChild(link);
                }).catch(err => {
                     // --- Restore on error too ---
                     logoElement.classList.remove('hide-for-png');
                     gradesheetElement.classList.remove('generating-png');
                     gradesheetElement.style.border = originalContainerBorder;
                     gradesheetElement.style.boxShadow = originalContainerShadow;
                     // ---
                     console.error('Error generating PNG:', err);
                     if (err.message.includes('Tainted canvases may not be exported')) {
                         alert('Could not save as PNG due to image security restrictions (CORS). Ensure the logo image is loaded correctly or try running from a local web server (like XAMPP using http://localhost/).');
                     } else {
                         alert('Could not save as PNG. Check browser console for errors.');
                     }
                 });
            } else {
                if (!logoElement) alert('Could not find logo element (#schoolLogo).');
                else if (!html2canvas) alert('html2canvas library not loaded.');
                else alert('Could not find gradesheet element.');
            }
        });
    </script>

</body>
</html>